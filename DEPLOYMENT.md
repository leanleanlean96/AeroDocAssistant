"""
ИНСТРУКЦИЯ ПО РАЗВЕРТЫВАНИЮ И ИСПОЛЬЗОВАНИЮ BACKEND'а
Aviation Technical Documentation Assistant
"""

# ============================================================================
# БЫСТРЫЙ СТАРТ
# ============================================================================

## Вариант 1: Локальный запуск на Windows

1. Откройте PowerShell или Command Prompt

2. Перейдите в папку проекта:
   cd C:\Users\1\OneDrive\Desktop\hakaton_fastapi

3. Двойным кликом запустите run.bat
   или выполните команду:
   run.bat

4. Приложение запустится на http://localhost:8000


## Вариант 2: Локальный запуск с pip (рекомендуется)

1. Откройте PowerShell и перейдите в папку проекта

2. Создайте виртуальное окружение (опционально):
   python -m venv venv
   .\venv\Scripts\Activate

3. Установите зависимости:
   pip install -r requirements.txt

4. Создайте .env файл:
   copy .env.example .env

5. Отредактируйте .env и добавьте ваш SBER_API_KEY

6. Запустите приложение:
   cd src
   python -m uvicorn main:app --reload --host 0.0.0.0 --port 8000

7. Откройте браузер: http://localhost:8000/docs


## Вариант 3: Docker (рекомендуется для продакшена)

1. Убедитесь, что установлены Docker и Docker Compose

2. Создайте .env файл:
   copy .env.example .env
   # Отредактируйте и добавьте SBER_API_KEY

3. Запустите приложение:
   docker-compose up -d

4. Приложение запустится на http://localhost:8000

5. Для остановки:
   docker-compose down


# ============================================================================
# КОНФИГУРАЦИЯ
# ============================================================================

Отредактируйте файл .env:

```
SBER_API_KEY=your_sber_api_key_here
SBER_API_URL=https://api.sber.ru/embeddings/v1
CHROMA_DB_PATH=./data/chroma_db
LOG_LEVEL=INFO
CORS_ORIGINS=["http://localhost:3000", "http://localhost:8000"]
```

Параметры:
- SBER_API_KEY: Ваш API ключ Sber для embeddings
- SBER_API_URL: URL API Sber
- CHROMA_DB_PATH: Путь к директории базы данных
- LOG_LEVEL: Уровень логирования (DEBUG, INFO, WARNING, ERROR)
- CORS_ORIGINS: Разрешенные источники для CORS


# ============================================================================
# ИНИЦИАЛИЗАЦИЯ БАЗЫ ДАННЫХ
# ============================================================================

Чтобы добавить примеры документов:

1. После запуска приложения выполните:
   python init_db.py

2. Это добавит 6 примеров документов по авиационной технике

3. Проверьте результат:
   - Откройте http://localhost:8000/docs
   - Перейдите на GET /api/v1/documents
   - Нажмите "Try it out" → "Execute"


# ============================================================================
# API ДОКУМЕНТАЦИЯ
# ============================================================================

После запуска приложения документация доступна по адресам:

- Swagger UI: http://localhost:8000/docs
- ReDoc: http://localhost:8000/redoc

Все endpoints задокументированы с примерами использования.


# ============================================================================
# ПРИМЕРЫ ИСПОЛЬЗОВАНИЯ
# ============================================================================

Запустите примеры API клиента:

python examples.py

Это выполнит следующие операции:
1. Создание документов
2. Семантический поиск
3. Вопрос-ответ
4. Управление графом знаний
5. Проверку консистентности
6. Получение статистики


# ============================================================================
# ОСНОВНЫЕ ENDPOINTS
# ============================================================================

### Здоровье приложения
GET /health - Проверка статуса приложения
GET /api/v1/info - Информация о приложении

### Управление документами
POST   /api/v1/documents - Создать документ
GET    /api/v1/documents - Получить все документы
GET    /api/v1/documents/{doc_id} - Получить документ
PUT    /api/v1/documents/{doc_id} - Обновить документ
DELETE /api/v1/documents/{doc_id} - Удалить документ
GET    /api/v1/documents/stats/overview - Статистика

### Поиск и Q&A
POST /api/v1/search/semantic - Семантический поиск
POST /api/v1/search/qa - Вопрос-ответ

### Граф знаний
GET    /api/v1/graph - Получить граф
POST   /api/v1/graph/links - Добавить связь
DELETE /api/v1/graph/links/{source}/{target} - Удалить связь
GET    /api/v1/graph/related/{doc_id} - Связанные документы
GET    /api/v1/graph/contradictions - Найти противоречия
POST   /api/v1/graph/consistency/{doc_id} - Проверить консистентность


# ============================================================================
# ПРИМЕР: CURL ЗАПРОСЫ
# ============================================================================

## Создать документ
curl -X POST http://localhost:8000/api/v1/documents \
  -H "Content-Type: application/json" \
  -d '{
    "title": "Руководство по ремонту",
    "content": "Содержание документа...",
    "document_type": "repair_manual",
    "version": "1.0",
    "tags": ["repair", "maintenance"]
  }'

## Семантический поиск
curl -X POST http://localhost:8000/api/v1/search/semantic \
  -H "Content-Type: application/json" \
  -d '{
    "query": "Какие требования к материалам?",
    "top_k": 5
  }'

## Ответить на вопрос
curl -X POST http://localhost:8000/api/v1/search/qa \
  -H "Content-Type: application/json" \
  -d '{
    "question": "Как выполнить техническое обслуживание?",
    "top_k_context": 5
  }'

## Получить все документы
curl http://localhost:8000/api/v1/documents

## Получить граф знаний
curl http://localhost:8000/api/v1/graph


# ============================================================================
# ТИПЫ ДОКУМЕНТОВ
# ============================================================================

- eskd - Единая система конструкторской документации (чертежи)
- estd - Единая система технологической документации (процессы)
- repair_manual - Руководство по ремонту
- material_cert - Сертификат материала
- test_report - Отчет об испытаниях
- standard - Отраслевой стандарт
- other - Прочие документы


# ============================================================================
# ТИПЫ СВЯЗЕЙ В ГРАФЕ
# ============================================================================

- related - Документы связаны между собой
- references - Документ ссылается на другой
- contradicts - Документы противоречат друг другу
- updates - Документ обновляет/заменяет другой


# ============================================================================
# ЛОГИРОВАНИЕ
# ============================================================================

Логи приложения выводятся в консоль с форматом:
2023-12-11 15:30:45,123 - service_name - INFO - Сообщение лога

Для изменения уровня логирования отредактируйте .env:
- DEBUG: Детальная информация для отладки
- INFO: Основная информация о работе
- WARNING: Предупреждения
- ERROR: Ошибки


# ============================================================================
# ОБРАБОТКА ОШИБОК
# ============================================================================

Все ошибки API возвращаются в формате:

{
  "detail": "Описание ошибки",
  "status_code": 400
}

Основные коды ошибок:
- 200: OK
- 201: Created
- 204: No Content
- 400: Bad Request (ошибка в запросе)
- 404: Not Found (ресурс не найден)
- 500: Internal Server Error (ошибка сервера)


# ============================================================================
# ПРОИЗВОДИТЕЛЬНОСТЬ И МАСШТАБИРОВАНИЕ
# ============================================================================

### Текущие ограничения (MVP):
- Максимум 10000 документов рекомендуется
- Поиск выполняется за <100мс для типичного запроса
- Mock embeddings для демонстрации (готово к Sber API)

### Масштабирование:
1. Используйте несколько инстансов FastAPI за Nginx
2. Используйте Redis для кеширования
3. Используйте Qdrant вместо Chroma для больших объемов
4. Реализуйте пулинг соединений к LLM


# ============================================================================
# ОТЛАДКА
# ============================================================================

### Проверка подключения
curl http://localhost:8000/health

### Просмотр логов (Docker)
docker-compose logs -f backend

### Проверка конфигурации
curl http://localhost:8000/api/v1/info

### Очистка базы данных
rm -rf data/chroma_db
# После этого нужно перезапустить приложение


# ============================================================================
# КОНТАКТЫ И ПОДДЕРЖКА
# ============================================================================

Проект: Aviation Technical Documentation Assistant
Версия: 1.0.0
Технологии: FastAPI, Chroma, Sber Embeddings, NetworkX

Для вопросов и предложений обратитесь к разработчикам.
"""

# Сохраняем как комментарий в файл
if __name__ == "__main__":
    print(__doc__)
